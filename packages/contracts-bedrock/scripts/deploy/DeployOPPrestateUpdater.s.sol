// SPDX-License-Identifier: MIT
pragma solidity 0.8.15;

// Scripting
import { Script } from "forge-std/Script.sol";

// Libraries
import { LibString } from "@solady/utils/LibString.sol";

// Scripts
import { BaseDeployIO } from "scripts/deploy/BaseDeployIO.sol";
import { DeployUtils } from "scripts/libraries/DeployUtils.sol";

// Interfaces
import { ISuperchainConfig } from "interfaces/L1/ISuperchainConfig.sol";
import { IProtocolVersions } from "interfaces/L1/IProtocolVersions.sol";
import { IOPContractsManager } from "interfaces/L1/IOPContractsManager.sol";
import { IOPPrestateUpdater } from "interfaces/L1/IOPPrestateUpdater.sol";
import { IProxyAdmin } from "interfaces/universal/IProxyAdmin.sol";
import { IDelayedWETH } from "interfaces/dispute/IDelayedWETH.sol";
// Contracts
import { OPPrestateUpdater } from "src/L1/OPPrestateUpdater.sol";

interface IOPContractsManager180 {
struct Blueprints {
    address addressManager;
        address proxy;
        address proxyAdmin;
        address l1ChugSplashProxy;
        address resolvedDelegateProxy;
        address anchorStateRegistry;
        address permissionedDisputeGame1;
        address permissionedDisputeGame2;
    }
    function blueprints() external view returns (Blueprints memory);
}

contract DeployOPPrestateUpdater is Script {
    bytes32 internal _salt = DeployUtils.DEFAULT_SALT;

    function deployOPPrestateUpdater(
        string memory _baseChain
    )
        public
        returns (OPPrestateUpdater oppu)
    {
        string memory superchainBasePath = "./lib/superchain-registry/superchain/configs/";
        string memory superchainToml = vm.readFile(string.concat(superchainBasePath, _baseChain, "/superchain.toml"));

        // Superchain shared contracts
        ISuperchainConfig superchainConfig = ISuperchainConfig(vm.parseTomlAddress(superchainToml, ".superchain_config_addr"));
        IProtocolVersions protocolVersions = IProtocolVersions(vm.parseTomlAddress(superchainToml, ".protocol_versions_addr"));
        IOPContractsManager180 opContractsManager180 = IOPContractsManager180(vm.parseTomlAddress(superchainToml, ".op_contracts_manager_proxy_addr"));


        // forgefmt: disable-start
        IOPContractsManager.Blueprints memory blueprints;
        blueprints.addressManager = address(0);
        blueprints.proxy = address(0);
        blueprints.proxyAdmin = address(0);
        blueprints.l1ChugSplashProxy = address(0);
        blueprints.resolvedDelegateProxy = address(0);

        IOPContractsManager180.Blueprints memory blueprints180 = opContractsManager180.blueprints();
        blueprints.permissionedDisputeGame1 = blueprints180.permissionedDisputeGame1;
        blueprints.permissionedDisputeGame2 = blueprints180.permissionedDisputeGame2;

        vm.startBroadcast(msg.sender);
        bytes memory faultDisputeGameInitcode = "0x60c06040523480156200001157600080fd5b5060405162004c2b38038062004c2b8339810160408190526200003491620001b7565b6200003f826200006f565b6200004a816200006f565b6001600160a01b03808316608052811660a05262000067620000e2565b5050620001f6565b6001600160a01b038116620000a7576040516370de323160e01b81526001600160a01b03821660048201526024015b60405180910390fd5b806001600160a01b03163b600003620000df576040516310d76a3760e31b81526001600160a01b03821660048201526024016200009e565b50565b600054610100900460ff16156200014c5760405162461bcd60e51b815260206004820152602760248201527f496e697469616c697a61626c653a20636f6e747261637420697320696e697469604482015266616c697a696e6760c81b60648201526084016200009e565b60005460ff90811610156200019f576000805460ff191660ff9081179091556040519081527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b565b6001600160a01b0381168114620000df57600080fd5b60008060408385031215620001cb57600080fd5b8251620001d881620001a1565b6020840151909250620001eb81620001a1565b809150509250929050565b60805160a0516149e562000246600039600061027d015260008181610125015281816122910152818161244701528181612783015281816127f00152818161284d01526128b901526149e56000f3fe608060405234801561001057600080fd5b50600436106100c95760003560e01c8063613e827b11610081578063b51f9c2b1161005b578063b51f9c2b146102a7578063eb335f751461036d578063f922d0501461038357600080fd5b8063613e827b146102585780636624856a146102785780637be0ca5e1461029f57600080fd5b806335e80ab3116100b257806335e80ab31461012057806354fd4d501461014757806355acef3d1461019057600080fd5b806324d0417e146100ce578063318b1b80146100e3575b600080fd5b6100e16100dc366004613747565b6103b9565b005b6100f66100f1366004613893565b610814565b60405173ffffffffffffffffffffffffffffffffffffffff90911681526020015b60405180910390f35b6100f67f000000000000000000000000000000000000000000000000000000000000000081565b6101836040518060400160405280600d81526020017f312e302e302d626574612e32300000000000000000000000000000000000000081525081565b6040516101179190613926565b61020b61019e366004613939565b8151602081840181018051600282529282019482019490942091909352815180830184018051928152908401929093019190912091525473ffffffffffffffffffffffffffffffffffffffff81169074010000000000000000000000000000000000000000900460e01b82565b6040805173ffffffffffffffffffffffffffffffffffffffff90931683527fffffffff00000000000000000000000000000000000000000000000000000000909116602083015201610117565b61026b61026636600461399d565b61088f565b60405161011791906139d9565b6100f67f000000000000000000000000000000000000000000000000000000000000000081565b6101836117e8565b6103606040805161010081018252600080825260208201819052918101829052606081018290526080810182905260a0810182905260c0810182905260e081019190915250604080516101008101825260045473ffffffffffffffffffffffffffffffffffffffff9081168252600554811660208301526006548116928201929092526007548216606082015260085482166080820152600954821660a0820152600a54821660c0820152600b5490911660e082015290565b6040516101179190613b8a565b610375600081565b604051908152602001610117565b6100f6610391366004613893565b60036020526000908152604090205473ffffffffffffffffffffffffffffffffffffffff1681565b600054610100900460ff16158080156103d95750600054600160ff909116105b806103f35750303b1580156103f3575060005460ff166001145b610484576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201527f647920696e697469616c697a656400000000000000000000000000000000000060648201526084015b60405180910390fd5b600080547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0016600117905580156104e257600080547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00ff166101001790555b8160600151156105005760408201516001906104fe9082613cf8565b505b7fc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a47060016040516105309190613ea3565b60405180910390200361056f576040517fe7a227dc00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60005b8260200151518110156106da5760008360200151828151811061059757610597613eaf565b602002602001015190506000600285604001516040516105b79190613ede565b908152604051908190036020018120835190916105d49190613ede565b908152604051908190036020019020805490915073ffffffffffffffffffffffffffffffffffffffff1615610635576040517f63b4904e00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60209182015191820151815492517fffffffffffffffff0000000000000000000000000000000000000000000000009093167401000000000000000000000000000000000000000060e09290921c919091027fffffffffffffffffffffffff0000000000000000000000000000000000000000161773ffffffffffffffffffffffffffffffffffffffff909216919091179055806106d281613f29565b915050610572565b5081518051600480547fffffffffffffffffffffffff000000000000000000000000000000000000000090811673ffffffffffffffffffffffffffffffffffffffff93841617909155602083015160058054831691841691909117905560408301516006805483169184169190911790556060830151600780548316918416919091179055608083015160088054831691841691909117905560a083015160098054831691841691909117905560c0830151600a8054831691841691909117905560e090920151600b80549093169116179055801561081057600080547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00ff169055604051600181527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b5050565b604080516020808201849052825180830382018152828401845280519101206000606083018190527fffffffffffffffffffffffffffffffffffffff00000000000000000000000000821660618401528351605481850301815260749093019093528291819061088390613f61565b60601c95945050505050565b604080516101e081018252600080825260208201819052918101829052606081018290526080810182905260a0810182905260c0810182905260e08101829052610100810182905261012081018290526101408101829052610160810182905261018081018290526101a081018290526101c081019190915261091182611876565b6101008201356000610927610140850185613fb1565b8080601f016020809104026020016040519081016040528093929190818152602001838380828437600092018290525060405194955093610971935086925085915060200161401d565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe081840301815282825280516020918201206101e0840183526000808552918401829052918301819052606083018190526080830181905260a0830181905260c0830181905260e08301819052610100830181905261012083018190526101408301819052610160830181905261018083018190526101a083018190526101c08301529150600454610a3d9073ffffffffffffffffffffffffffffffffffffffff1683611c66565b73ffffffffffffffffffffffffffffffffffffffff908116602083810191909152600654604080513093810193909352610a8e9391909116918591015b604051602081830303815290604052611c8c565b73ffffffffffffffffffffffffffffffffffffffff90811680835260208301516040517f0652b57a0000000000000000000000000000000000000000000000000000000081529216600483015290630652b57a90602401600060405180830381600087803b158015610aff57600080fd5b505af1158015610b13573d6000803e3d6000fd5b50505050610b5c848260000151856040518060400160405280600e81526020017f4c31455243373231427269646765000000000000000000000000000000000000815250611de0565b73ffffffffffffffffffffffffffffffffffffffff1660408083019190915281518151808301909252600e82527f4f7074696d69736d506f7274616c0000000000000000000000000000000000006020830152610bbd918691908690611de0565b73ffffffffffffffffffffffffffffffffffffffff1660e0820152805160408051808201909152600c81527f53797374656d436f6e66696700000000000000000000000000000000000000006020820152610c1b9186918690611de0565b73ffffffffffffffffffffffffffffffffffffffff166060820152805160408051808201909152601c81527f4f7074696d69736d4d696e7461626c654552433230466163746f7279000000006020820152610c799186918690611de0565b73ffffffffffffffffffffffffffffffffffffffff166080820152805160408051808201909152601281527f4469737075746547616d65466163746f727900000000000000000000000000006020820152610cd79186918690611de0565b73ffffffffffffffffffffffffffffffffffffffff16610100820152805160408051808201909152601381527f416e63686f7253746174655265676973747279000000000000000000000000006020820152610d369186918690611de0565b73ffffffffffffffffffffffffffffffffffffffff9081166101208301526007548251604080519184166020830152610d76939290921691859101610a7a565b73ffffffffffffffffffffffffffffffffffffffff90811660a0830181905282516040517f8d52d4a0000000000000000000000000000000000000000000000000000000008152921691638d52d4a091610dd59160019060040161403e565b600060405180830381600087803b158015610def57600080fd5b505af1158015610e03573d6000803e3d6000fd5b5050604080518082018252601a81527f4f564d5f4c3143726f7373446f6d61696e4d657373656e676572000000000000602080830191909152600854868201519351929550610e72945073ffffffffffffffffffffffffffffffffffffffff16928792610a7a9287910161409f565b73ffffffffffffffffffffffffffffffffffffffff90811660c0840181905283516040517f8d52d4a0000000000000000000000000000000000000000000000000000000008152921691638d52d4a091610ed19160029060040161403e565b600060405180830381600087803b158015610eeb57600080fd5b505af1158015610eff573d6000803e3d6000fd5b5050835160c08501516040517f860f7cda00000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff909216935063860f7cda9250610f5d91859060040161409f565b600060405180830381600087803b158015610f7757600080fd5b505af1158015610f8b573d6000803e3d6000fd5b50505050602082015182516040517ff2fde38b00000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff918216600482015291169063f2fde38b90602401600060405180830381600087803b158015610fff57600080fd5b505af1158015611013573d6000803e3d6000fd5b50506009546101008501516040805173ffffffffffffffffffffffffffffffffffffffff92831660208201526110529550919092169250869101610a7a565b73ffffffffffffffffffffffffffffffffffffffff16610140830152815160408051808201909152601b81527f44656c61796564574554485065726d697373696f6e656447616d65000000000060208201526110b19187918790611de0565b73ffffffffffffffffffffffffffffffffffffffff9081166101a0840152600a54600b546110f6929182169116856110f16110eb8c6141a5565b87611e6c565b611fa5565b73ffffffffffffffffffffffffffffffffffffffff16610180830152604080518082019091526000808252602082015260606111666040518060400160405280600e81526020017f4c314552433732314272696467650000000000000000000000000000000000008152506121c8565b9150611176826020015185612287565b84516040860151845192935061118c9284612368565b6111ca6040518060400160405280600e81526020017f4f7074696d69736d506f7274616c0000000000000000000000000000000000008152506121c8565b91506111da826020015185612411565b845160e086015184519293506111f09284612368565b61122e6040518060400160405280600c81526020017f53797374656d436f6e66696700000000000000000000000000000000000000008152506121c8565b8451606086015182516040517f99a88ec400000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff9283166004820152908216602482015292945016906399a88ec490604401600060405180830381600087803b1580156112aa57600080fd5b505af11580156112be573d6000803e3d6000fd5b505050506112da82602001518a6112d4906141a5565b86612480565b8451606086015184519293506112f09284612368565b61132e6040518060400160405280601c81526020017f4f7074696d69736d4d696e7461626c654552433230466163746f7279000000008152506121c8565b915061133e82602001518561272c565b8451608086015184519293506113549284612368565b6113926040518060400160405280601681526020017f4c3143726f7373446f6d61696e4d657373656e676572000000000000000000008152506121c8565b91506113a282602001518561275e565b845160c086015184519293506113b89284612368565b6113f66040518060400160405280601081526020017f4c315374616e64617264427269646765000000000000000000000000000000008152506121c8565b91506114068260200151856127c3565b845160a0860151845192935061141c9284612368565b61145a6040518060400160405280600b81526020017f44656c61796564574554480000000000000000000000000000000000000000008152506121c8565b915061147382602001518a61146e906141a5565b612828565b84516101a0860151845192935061148a9284612368565b6114c86040518060400160405280601281526020017f4469737075746547616d65466163746f727900000000000000000000000000008152506121c8565b91506114e182602001518a6114dc906141a5565b612881565b845161010086015184519293506114f89284612368565b6101008401516101808501516040517f14f6b1a30000000000000000000000000000000000000000000000000000000081526001600482015273ffffffffffffffffffffffffffffffffffffffff91821660248201529116906314f6b1a390604401600060405180830381600087803b15801561157457600080fd5b505af1158015611588573d6000803e3d6000fd5b5050505061010084015173ffffffffffffffffffffffffffffffffffffffff1663f2fde38b6115ba60208c018c6142c2565b6040517fffffffff0000000000000000000000000000000000000000000000000000000060e084901b16815273ffffffffffffffffffffffffffffffffffffffff9091166004820152602401600060405180830381600087803b15801561162057600080fd5b505af1158015611634573d6000803e3d6000fd5b50505061014085015173ffffffffffffffffffffffffffffffffffffffff168352507f5e05fbd000000000000000000000000000000000000000000000000000000000602083018190526116909061168b8b6141a5565b612897565b845161012086015184519293506116a79284612368565b835173ffffffffffffffffffffffffffffffffffffffff1663f2fde38b6116d160208c018c6142c2565b6040517fffffffff0000000000000000000000000000000000000000000000000000000060e084901b16815273ffffffffffffffffffffffffffffffffffffffff9091166004820152602401600060405180830381600087803b15801561173757600080fd5b505af115801561174b573d6000803e3d6000fd5b505050503373ffffffffffffffffffffffffffffffffffffffff168760007f9fbdf97c6b496bf20189c3c23d0640336fce48e18810c9b84558ec31de0ab9b08760405160200161179b91906139d9565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0818403018152908290526117d391613926565b60405180910390a45091979650505050505050565b600180546117f590613c56565b80601f016020809104026020016040519081016040528092919081815260200182805461182190613c56565b801561186e5780601f106118435761010080835404028352916020019161186e565b820191906000526020600020905b81548152906001019060200180831161185157829003601f168201915b505050505081565b610100810135158061188c575046816101000135145b156118c3576040517f7a47c9a200000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60006118d260208301836142c2565b73ffffffffffffffffffffffffffffffffffffffff160361194f576040517fe646e04300000000000000000000000000000000000000000000000000000000815260206004820152601660248201527f6f70436861696e50726f787941646d696e4f776e657200000000000000000000604482015260640161047b565b600061196160408301602084016142c2565b73ffffffffffffffffffffffffffffffffffffffff16036119de576040517fe646e04300000000000000000000000000000000000000000000000000000000815260206004820152601160248201527f73797374656d436f6e6669674f776e6572000000000000000000000000000000604482015260640161047b565b60006119f060608301604084016142c2565b73ffffffffffffffffffffffffffffffffffffffff1603611a6d576040517fe646e04300000000000000000000000000000000000000000000000000000000815260206004820152600760248201527f6261746368657200000000000000000000000000000000000000000000000000604482015260640161047b565b6000611a7f60808301606084016142c2565b73ffffffffffffffffffffffffffffffffffffffff1603611afc576040517fe646e04300000000000000000000000000000000000000000000000000000000815260206004820152601160248201527f756e73616665426c6f636b5369676e6572000000000000000000000000000000604482015260640161047b565b6000611b0e60a08301608084016142c2565b73ffffffffffffffffffffffffffffffffffffffff1603611b8b576040517fe646e04300000000000000000000000000000000000000000000000000000000815260206004820152600860248201527f70726f706f736572000000000000000000000000000000000000000000000000604482015260640161047b565b6000611b9d60c0830160a084016142c2565b73ffffffffffffffffffffffffffffffffffffffff1603611c1a576040517fe646e04300000000000000000000000000000000000000000000000000000000815260206004820152600a60248201527f6368616c6c656e67657200000000000000000000000000000000000000000000604482015260640161047b565b611c28610120820182613fb1565b9050600003611c63576040517f86ad7eeb00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b50565b60408051600080825260208201909252611c839084908490611c8c565b90505b92915050565b600080611cca8573ffffffffffffffffffffffffffffffffffffffff16803b806020016040519081016040528181526000908060200190933c61296f565b805190915060ff1615611d115780516040517f1a66c69200000000000000000000000000000000000000000000000000000000815260ff909116600482015260240161047b565b60208101515115611d545780602001516040517f57a0583500000000000000000000000000000000000000000000000000000000815260040161047b9190613926565b6000816040015184604051602001611d6d9291906142dd565b6040516020818303038152906040529050848151602083016000f5925073ffffffffffffffffffffffffffffffffffffffff8316611dd7576040517f3011642500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b50509392505050565b600080858484604051602001611df89392919061430c565b604080518083037fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0018152828252805160209182012060055473ffffffffffffffffffffffffffffffffffffffff8a811693860193909352909450611e6293911691849101610a7a565b9695505050505050565b60608260e00151836101000151846101200151856101400151866101600151876101800151611ecf6040518060400160405280600481526020017f4d495053000000000000000000000000000000000000000000000000000000008152506121c8565b516101a08901516101208a015160608c01518c51608081015160a090910151604051611f8e9c9b9a9998979695949392919060200163ffffffff9c909c168c5260208c019a909a5260408b019890985260608a019690965267ffffffffffffffff94851660808a01529290931660a088015273ffffffffffffffffffffffffffffffffffffffff90811660c088015291821660e08701528116610100860152610120850191909152908116610140840152166101608201526101800190565b604051602081830303815290604052905092915050565b600080611fe38673ffffffffffffffffffffffffffffffffffffffff16803b806020016040519081016040528181526000908060200190933c61296f565b805190915060ff161561202a5780516040517f1a66c69200000000000000000000000000000000000000000000000000000000815260ff909116600482015260240161047b565b6020810151511561206d5780602001516040517f57a0583500000000000000000000000000000000000000000000000000000000815260040161047b9190613926565b60006120aa8673ffffffffffffffffffffffffffffffffffffffff16803b806020016040519081016040528181526000908060200190933c61296f565b805190915060ff16156120f15780516040517f1a66c69200000000000000000000000000000000000000000000000000000000815260ff909116600482015260240161047b565b602081015151156121345780602001516040517f57a0583500000000000000000000000000000000000000000000000000000000815260040161047b9190613926565b6000826040015182604001518660405160200161215393929190614337565b6040516020818303038152906040529050858151602083016000f5935073ffffffffffffffffffffffffffffffffffffffff84166121bd576040517f3011642500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b505050949350505050565b60408051808201909152600080825260208201526000600260016040516121ef9190613ea3565b90815260200160405180910390208360405161220b9190613ede565b908152604080519182900360209081018320838301909252905473ffffffffffffffffffffffffffffffffffffffff811683527fffffffff000000000000000000000000000000000000000000000000000000007401000000000000000000000000000000000000000090910460e01b16908201529392505050565b6060828260c001517f00000000000000000000000000000000000000000000000000000000000000006040516024016122e392919073ffffffffffffffffffffffffffffffffffffffff92831681529116602082015260400190565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08184030181529190526020810180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167fffffffff0000000000000000000000000000000000000000000000000000000090931692909217909152905092915050565b61237184612e2e565b61237a83612e2e565b61238382612e2e565b6040517f9623609d00000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff851690639623609d906123d99086908690869060040161437a565b600060405180830381600087803b1580156123f357600080fd5b505af1158015612407573d6000803e3d6000fd5b5050505050505050565b61010081015160608083015160405173ffffffffffffffffffffffffffffffffffffffff938416602482015290831660448201527f000000000000000000000000000000000000000000000000000000000000000090921660648301526001608483015290839060a4016122e3565b60606000826060015173ffffffffffffffffffffffffffffffffffffffff166354fd4d506040518163ffffffff1660e01b8152600401600060405180830381865afa1580156124d3573d6000803e3d6000fd5b505050506040513d6000823e601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016820160405261251991908101906143bc565b90506040518060400160405280600581526020017f322e322e300000000000000000000000000000000000000000000000000000008152506040516020016125619190613926565b60405160208183030381529060405280519060200120816040516020016125889190613926565b60405160208183030381529060405280519060200120036126a8576000806125b1878787612efc565b91509150868660000151602001518760200151886040015189600001516040015173ffffffffffffffffffffffffffffffffffffffff1660001b8a60c001518b6000015160600151886126078e60600151610814565b896040516024016126209998979695949392919061442a565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08184030181529190526020810180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167fffffffff0000000000000000000000000000000000000000000000000000000090931692909217909152935061272592505050565b6000806126b687878761310d565b91509150868660000151602001518760200151886040015189600001516040015173ffffffffffffffffffffffffffffffffffffffff1660001b8a60c001518b60000151606001518861270c8e60600151610814565b8960405160240161262099989796959493929190614546565b9392505050565b60a081015160405173ffffffffffffffffffffffffffffffffffffffff909116602482015260609083906044016122e3565b60e081015160608281015160405173ffffffffffffffffffffffffffffffffffffffff7f0000000000000000000000000000000000000000000000000000000000000000811660248301529384166044820152921660648301529083906084016122e3565b60c081015160608281015160405173ffffffffffffffffffffffffffffffffffffffff93841660248201527f000000000000000000000000000000000000000000000000000000000000000084166044820152921660648301529083906084016122e3565b80515160405173ffffffffffffffffffffffffffffffffffffffff91821660248201527f0000000000000000000000000000000000000000000000000000000000000000909116604482015260609083906064016122e3565b60405130602482015260609083906044016122e3565b6060600082608001518060200190518101906128b39190614699565b905083817f00000000000000000000000000000000000000000000000000000000000000006040516024016128e992919061479c565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08184030181529190526020810180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167fffffffff000000000000000000000000000000000000000000000000000000009093169290921790915291505092915050565b6129966040518060600160405280600060ff16815260200160608152602001606081525090565b600282511080612a005750816000815181106129b4576129b4613eaf565b6020910101517fff00000000000000000000000000000000000000000000000000000000000000167ffe0000000000000000000000000000000000000000000000000000000000000014155b80612a65575081600181518110612a1957612a19613eaf565b6020910101517fff00000000000000000000000000000000000000000000000000000000000000167f710000000000000000000000000000000000000000000000000000000000000014155b15612a9c576040517f31f56e1f00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6000600283600281518110612ab357612ab3613eaf565b602001015160f81c60f81b60fc60f81b1660f81c60ff16901c9050600083600281518110612ae357612ae3613eaf565b60209101015160f81c60039081169150819003612b2c576040517fb214675a00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600060ff821615612c185760008260ff1667ffffffffffffffff811115612b5557612b556133cc565b6040519080825280601f01601f191660200182016040528015612b7f576020820181803683370190505b50905060005b8360ff16811015612c0a5786612b9c82600361481b565b81518110612bac57612bac613eaf565b602001015160f81c60f81b828281518110612bc957612bc9613eaf565b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535080612c0281613f29565b915050612b85565b50612c148161330b565b9150505b60008167ffffffffffffffff811115612c3357612c336133cc565b6040519080825280601f01601f191660200182016040528015612c5d576020820181803683370190505b50905060ff831615612d02576000612c76846003614833565b60ff16905060005b83811015612cff5787612c91828461481b565b81518110612ca157612ca1613eaf565b602001015160f81c60f81b838281518110612cbe57612cbe613eaf565b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535080612cf781613f29565b915050612c7e565b50505b600082612d10856003614833565b60ff16612d1d919061481b565b90506000818851612d2e9190614858565b905080600003612d6a576040517f028512d400000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60008167ffffffffffffffff811115612d8557612d856133cc565b6040519080825280601f01601f191660200182016040528015612daf576020820181803683370190505b50905060008360208b0101602083018481868460045afa9250505080612e01576040517ff7046f3000000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60405180606001604052808960ff1681526020018681526020018381525098505050505050505050919050565b73ffffffffffffffffffffffffffffffffffffffff8116612e93576040517f70de323100000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff8216600482015260240161047b565b8073ffffffffffffffffffffffffffffffffffffffff163b600003611c63576040517f86bb51b800000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff8216600482015260240161047b565b6040805160c081018252600080825260208201819052918101829052606081018290526080810182905260a08101919091526040805160c081018252600080825260208201819052918101829052606081018290526080810182905260a08101919091526000612fe56040805160c081018252600080825260208201819052918101829052606081018290526080810182905260a0810191909152506040805160c0810182526301312d008152600a6020820152600891810191909152633b9aca006060820152620f424060808201526fffffffffffffffffffffffffffffffff60a082015290565b90508092506040518060c001604052808560c0015173ffffffffffffffffffffffffffffffffffffffff168152602001856040015173ffffffffffffffffffffffffffffffffffffffff1681526020018560a0015173ffffffffffffffffffffffffffffffffffffffff16815260200185610100015173ffffffffffffffffffffffffffffffffffffffff1681526020018560e0015173ffffffffffffffffffffffffffffffffffffffff168152602001856080015173ffffffffffffffffffffffffffffffffffffffff1681525091506130c38260000151612e2e565b6130d08260200151612e2e565b6130dd8260400151612e2e565b6130ea8260600151612e2e565b6130f78260800151612e2e565b6131048260a00151612e2e565b50935093915050565b6040805160c081018252600080825260208201819052918101829052606081018290526080810182905260a08101919091526040805160e081018252600080825260208201819052918101829052606081018290526080810182905260a0810182905260c081019190915260006131fd6040805160c081018252600080825260208201819052918101829052606081018290526080810182905260a0810191909152506040805160c0810182526301312d008152600a6020820152600891810191909152633b9aca006060820152620f424060808201526fffffffffffffffffffffffffffffffff60a082015290565b90508092506040518060e001604052808560c0015173ffffffffffffffffffffffffffffffffffffffff168152602001856040015173ffffffffffffffffffffffffffffffffffffffff1681526020018560a0015173ffffffffffffffffffffffffffffffffffffffff16815260200185610100015173ffffffffffffffffffffffffffffffffffffffff1681526020018560e0015173ffffffffffffffffffffffffffffffffffffffff168152602001856080015173ffffffffffffffffffffffffffffffffffffffff16815260200173eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee73ffffffffffffffffffffffffffffffffffffffff1681525091506130c38260000151612e2e565b6000602082511115613349576040517f5623dc1c00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6000805b83518110156133c55761336181600161481b565b845161336d9190614858565b61337890600861486f565b6133839060026149cc565b84828151811061339557613395613eaf565b01602001516133a7919060f81c61486f565b6133b1908361481b565b9150806133bd81613f29565b91505061334d565b5092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6040805190810167ffffffffffffffff8111828210171561341e5761341e6133cc565b60405290565b6040516080810167ffffffffffffffff8111828210171561341e5761341e6133cc565b604051610100810167ffffffffffffffff8111828210171561341e5761341e6133cc565b6040516101a0810167ffffffffffffffff8111828210171561341e5761341e6133cc565b604051601f82017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016810167ffffffffffffffff811182821017156134d6576134d66133cc565b604052919050565b803573ffffffffffffffffffffffffffffffffffffffff8116811461350257600080fd5b919050565b600067ffffffffffffffff821115613521576135216133cc565b5060051b60200190565b600067ffffffffffffffff821115613545576135456133cc565b50601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe01660200190565b600082601f83011261358257600080fd5b81356135956135908261352b565b61348f565b8181528460208386010111156135aa57600080fd5b816020850160208301376000918101602001919091529392505050565b600082601f8301126135d857600080fd5b813560206135e861359083613507565b82815260059290921b8401810191818101908684111561360757600080fd5b8286015b8481101561372c57803567ffffffffffffffff8082111561362c5760008081fd5b8189019150818a036060807fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0830112156136665760008081fd5b61366e6133fb565b88850135848111156136805760008081fd5b61368e8e8b83890101613571565b82525060409350837fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc0840112156136c55760008081fd5b6136cd6133fb565b92506136da8486016134de565b835293810135937fffffffff000000000000000000000000000000000000000000000000000000008516851461371257600093508384fd5b82890194909452508287015250835291830191830161360b565b509695505050505050565b8035801515811461350257600080fd5b60006020828403121561375957600080fd5b813567ffffffffffffffff8082111561377157600080fd5b9083019081850361016081121561378757600080fd5b61378f613424565b6101008083121561379f57600080fd5b6137a7613447565b92506137b2856134de565b83526137c0602086016134de565b60208401526137d1604086016134de565b60408401526137e2606086016134de565b60608401526137f3608086016134de565b608084015261380460a086016134de565b60a084015261381560c086016134de565b60c084015261382660e086016134de565b60e084015291815290830135908282111561384057600080fd5b61384c878386016135c7565b602082015261012084013591508282111561386657600080fd5b61387287838601613571565b60408201526138846101408501613737565b60608201529695505050505050565b6000602082840312156138a557600080fd5b5035919050565b60005b838110156138c75781810151838201526020016138af565b838111156138d6576000848401525b50505050565b600081518084526138f48160208601602086016138ac565b601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0169290920160200192915050565b602081526000611c8360208301846138dc565b6000806040838503121561394c57600080fd5b823567ffffffffffffffff8082111561396457600080fd5b61397086838701613571565b9350602085013591508082111561398657600080fd5b5061399385828601613571565b9150509250929050565b6000602082840312156139af57600080fd5b813567ffffffffffffffff8111156139c657600080fd5b8201610240818503121561272557600080fd5b815173ffffffffffffffffffffffffffffffffffffffff1681526101e081016020830151613a1f602084018273ffffffffffffffffffffffffffffffffffffffff169052565b506040830151613a47604084018273ffffffffffffffffffffffffffffffffffffffff169052565b506060830151613a6f606084018273ffffffffffffffffffffffffffffffffffffffff169052565b506080830151613a97608084018273ffffffffffffffffffffffffffffffffffffffff169052565b5060a0830151613abf60a084018273ffffffffffffffffffffffffffffffffffffffff169052565b5060c0830151613ae760c084018273ffffffffffffffffffffffffffffffffffffffff169052565b5060e0830151613b0f60e084018273ffffffffffffffffffffffffffffffffffffffff169052565b506101008381015173ffffffffffffffffffffffffffffffffffffffff90811691840191909152610120808501518216908401526101408085015182169084015261016080850151821690840152610180808501518216908401526101a0808501518216908401526101c09384015116929091019190915290565b60006101008201905073ffffffffffffffffffffffffffffffffffffffff8084511683528060208501511660208401528060408501511660408401528060608501511660608401528060808501511660808401525060a0830151613c0660a084018273ffffffffffffffffffffffffffffffffffffffff169052565b5060c0830151613c2e60c084018273ffffffffffffffffffffffffffffffffffffffff169052565b5060e08301516133c560e084018273ffffffffffffffffffffffffffffffffffffffff169052565b600181811c90821680613c6a57607f821691505b602082108103613ca3577f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b50919050565b601f821115613cf357600081815260208120601f850160051c81016020861015613cd05750805b601f850160051c820191505b81811015613cef57828155600101613cdc565b5050505b505050565b815167ffffffffffffffff811115613d1257613d126133cc565b613d2681613d208454613c56565b84613ca9565b602080601f831160018114613d795760008415613d435750858301515b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff600386901b1c1916600185901b178555613cef565b6000858152602081207fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08616915b82811015613dc657888601518255948401946001909101908401613da7565b5085821015613e0257878501517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff600388901b60f8161c191681555b5050505050600190811b01905550565b60008154613e1f81613c56565b60018281168015613e375760018114613e6a57613e99565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0084168752821515830287019450613e99565b8560005260208060002060005b85811015613e905781548a820152908401908201613e77565b50505082870194505b5050505092915050565b6000611c838284613e12565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60008251613ef08184602087016138ac565b9190910192915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60007fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203613f5a57613f5a613efa565b5060010190565b6000815160208301517fffffffffffffffffffffffffffffffffffffffff00000000000000000000000080821693506014831015613fa95780818460140360031b1b83161693505b505050919050565b60008083357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe1843603018112613fe657600080fd5b83018035915067ffffffffffffffff82111561400157600080fd5b60200191503681900382131561401657600080fd5b9250929050565b82815260406020820152600061403660408301846138dc565b949350505050565b73ffffffffffffffffffffffffffffffffffffffff831681526040810160038310614092577f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b8260208301529392505050565b73ffffffffffffffffffffffffffffffffffffffff8316815260406020820152600061403660408301846138dc565b600060c082840312156140e057600080fd5b60405160c0810181811067ffffffffffffffff82111715614103576141036133cc565b604052905080614112836134de565b8152614120602084016134de565b6020820152614131604084016134de565b6040820152614142606084016134de565b6060820152614153608084016134de565b608082015261416460a084016134de565b60a08201525092915050565b63ffffffff81168114611c6357600080fd5b803561350281614170565b803567ffffffffffffffff8116811461350257600080fd5b600061024082360312156141b857600080fd5b6141c061346b565b6141ca36846140ce565b81526141d860c08401614182565b60208201526141e960e08401614182565b60408201526101008084013560608301526101208085013567ffffffffffffffff8082111561421757600080fd5b61422336838901613571565b60808601526101409150818701358181111561423e57600080fd5b61424a36828a01613571565b60a0870152505061016061425f81880161418d565b60c0860152610180614272818901614182565b60e08701526101a0880135858701526101c0880135848701526101e0880135838701526142a2610200890161418d565b828701526142b3610220890161418d565b90860152509295945050505050565b6000602082840312156142d457600080fd5b611c83826134de565b600083516142ef8184602088016138ac565b8351908301906143038183602088016138ac565b01949350505050565b83815260606020820152600061432560608301856138dc565b8281036040840152611e6281856138dc565b600084516143498184602089016138ac565b84519083019061435d8183602089016138ac565b84519101906143708183602088016138ac565b0195945050505050565b600073ffffffffffffffffffffffffffffffffffffffff8086168352808516602084015250606060408301526143b360608301846138dc565b95945050505050565b6000602082840312156143ce57600080fd5b815167ffffffffffffffff8111156143e557600080fd5b8201601f810184136143f657600080fd5b80516144046135908261352b565b81815285602083850101111561441957600080fd5b6143b38260208301602086016138ac565b73ffffffffffffffffffffffffffffffffffffffff8a8116825263ffffffff8a81166020840152891660408301526060820188905267ffffffffffffffff8716608083015285811660a08301526102608201906144e360c084018763ffffffff80825116835260ff602083015116602084015260ff6040830151166040840152806060830151166060840152806080830151166080840152506fffffffffffffffffffffffffffffffff60a08201511660a08301525050565b808516610180840152808451166101a0840152806020850151166101c0840152806040850151166101e084015280606085015116610200840152806080850151166102208401528060a085015116610240840152509a9950505050505050505050565b73ffffffffffffffffffffffffffffffffffffffff8a8116825263ffffffff8a81166020840152891660408301526060820188905267ffffffffffffffff8716608083015285811660a08301526102808201906145ff60c084018763ffffffff80825116835260ff602083015116602084015260ff6040830151166040840152806060830151166060840152806080830151166080840152506fffffffffffffffffffffffffffffffff60a08201511660a08301525050565b808516610180840152835181166101a0840152602084015181166101c0840152604084015181166101e08401526060840151811661020084015260808401511661022083015260a083015173ffffffffffffffffffffffffffffffffffffffff81166102408401525060c083015173ffffffffffffffffffffffffffffffffffffffff8116610260840152509a9950505050505050505050565b600060208083850312156146ac57600080fd5b825167ffffffffffffffff8111156146c357600080fd5b8301601f810185136146d457600080fd5b80516146e261359082613507565b8181526060918202830184019184820191908884111561470157600080fd5b938501935b83851015614790578489038181121561471f5760008081fd5b6147276133fb565b865161473281614170565b815260407fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe083018113156147665760008081fd5b61476e6133fb565b888a015181529088015189820152818901528452509384019391850191614706565b50979650505050505050565b6040808252835182820181905260009190606090818501906020808901865b838110156147ef578151805163ffffffff1686528301518051848701528301518786015293850193908201906001016147bb565b505082955073ffffffffffffffffffffffffffffffffffffffff88168188015250505050509392505050565b6000821982111561482e5761482e613efa565b500190565b600060ff821660ff84168060ff0382111561485057614850613efa565b019392505050565b60008282101561486a5761486a613efa565b500390565b6000817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff04831182151516156148a7576148a7613efa565b500290565b600181815b8085111561490557817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048211156148eb576148eb613efa565b808516156148f857918102915b93841c93908002906148b1565b509250929050565b60008261491c57506001611c86565b8161492957506000611c86565b816001811461493f576002811461494957614965565b6001915050611c86565b60ff84111561495a5761495a613efa565b50506001821b611c86565b5060208310610133831016604e8410600b8410161715614988575081810a611c86565b61499283836148ac565b807fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048211156149c4576149c4613efa565b029392505050565b6000611c83838361490d56fea164736f6c634300080f000a";
        (blueprints.permissionlessDisputeGame1, blueprints.permissionlessDisputeGame2) = DeployUtils.createDeterministicBlueprint(faultDisputeGameInitcode, _salt);
        vm.stopBroadcast();
        // forgefmt: disable-end

        oppu = OPPrestateUpdater(
            DeployUtils.createDeterministic({
                _name: "OPPrestateUpdater",
                _args: DeployUtils.encodeConstructor(
                    abi.encodeCall(IOPPrestateUpdater.__constructor__, (superchainConfig, protocolVersions, blueprints))
                ),
                _salt: bytes32(_salt)
            })
        );

        require(address(oppu.superchainConfig()) == address(superchainConfig), "OPPUI-10");
        require(address(oppu.protocolVersions()) == address(protocolVersions), "OPPUI-20");
        require(LibString.eq(oppu.l1ContractsRelease(), "none"), "OPPUI-30");

        require(oppu.upgradeController() == address(0), "OPPUI-40");

        // encode decode because oppu.implementations returns IOPPrestateUpdater.Implmentations
        IOPContractsManager.Implementations memory implementations =
            abi.decode(abi.encode(oppu.implementations()), (IOPContractsManager.Implementations));
        require(implementations.l1CrossDomainMessengerImpl == address(0), "OPPUI-120");
        require(implementations.l1StandardBridgeImpl == address(0), "OPPUI-130");
        require(implementations.disputeGameFactoryImpl == address(0), "OPPUI-140");
        require(implementations.optimismMintableERC20FactoryImpl == address(0), "OPPUI-150");
        require(implementations.l1CrossDomainMessengerImpl == address(0), "OPPUI-160");
        require(implementations.l1StandardBridgeImpl == address(0), "OPPUI-170");
        require(implementations.disputeGameFactoryImpl == address(0), "OPPUI-180");
        require(implementations.anchorStateRegistryImpl == address(0), "OPPUI-190");
        require(implementations.delayedWETHImpl == address(0), "OPPUI-200");
        require(implementations.mipsImpl == address(0), "OPPUI-210");
    }
}
